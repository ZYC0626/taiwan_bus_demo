(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2b8c25ec"],{"0168":function(t,e,o){t.exports=o.p+"img/busStop_in.bee2e2f7.svg"},11343:function(t,e,o){var i;
/** @license
 *
 *  Copyright (C) 2012 K. Arthur Endsley (kaendsle@mtu.edu)
 *  Michigan Tech Research Institute (MTRI)
 *  3600 Green Court, Suite 100, Ann Arbor, MI, 48105
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 */(function(s,n){i=function(){return n()}.call(e,o,e,t),void 0===i||(t.exports=i)})(0,(function(){var t,e,o;return this,o=function(t){return t instanceof o?t:this instanceof o?void(this._wrapped=t):new o(t)},t=function(t,e){return t.substring(0,e.length)===e},e=function(t,e){return t.substring(t.length-e.length)===e},o.delimiter=" ",o.isArray=function(t){return!(!t||t.constructor!==Array)},o.trim=function(o,i){i=i||" ";while(t(o,i))o=o.substring(1);while(e(o,i))o=o.substring(0,o.length-1);return o},o.Wkt=function(t){this.delimiter=o.delimiter||" ",this.wrapVertices=!0,this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+|\+/,numeric:/-*\d+(\.*\d+)?/,comma:/\s*,\s*/,parenComma:/\)\s*,\s*\(/,coord:/-*\d+\.*\d+ -*\d+\.*\d+/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,ogcTypes:/^(multi)?(point|line|polygon|box)?(string)?$/i,crudeJson:/^{.*"(type|coordinates|geometries|features)":.*}$/},this._stripWhitespaceAndParens=function(t){var e=t.trim(),o=e.replace(/^\(?(.*?)\)?$/,"$1");return o},this.components=void 0,t&&"string"===typeof t?this.read(t):t&&void 0!==typeof t&&this.fromObject(t)},o.Wkt.prototype.isCollection=function(){switch(this.type.slice(0,5)){case"multi":return!0;case"polyg":return!0;default:return!1}},o.Wkt.prototype.sameCoords=function(t,e){return t.x===e.x&&t.y===e.y},o.Wkt.prototype.fromObject=function(t){var e;return e=t.hasOwnProperty("type")&&t.hasOwnProperty("coordinates")?this.fromJson(t):this.deconstruct.call(this,t),this.components=e.components,this.isRectangle=e.isRectangle||!1,this.type=e.type,this},o.Wkt.prototype.toObject=function(t){var e=this.construct[this.type].call(this,t);return"object"!==typeof e||o.isArray(e)||(e.properties=this.properties),e},o.Wkt.prototype.toString=function(t){return this.write()},o.Wkt.prototype.fromJson=function(t){var e,i,s,n,a,c;if(this.type=t.type.toLowerCase(),this.components=[],t.hasOwnProperty("geometry"))return this.fromJson(t.geometry),this.properties=t.properties,this;if(n=t.coordinates,o.isArray(n[0])){for(e in n)if(n.hasOwnProperty(e))if(o.isArray(n[e][0])){for(i in c=[],n[e])if(n[e].hasOwnProperty(i))if(o.isArray(n[e][i][0])){for(s in a=[],n[e][i])n[e][i].hasOwnProperty(s)&&a.push({x:n[e][i][s][0],y:n[e][i][s][1]});c.push(a)}else c.push({x:n[e][i][0],y:n[e][i][1]});this.components.push(c)}else"multipoint"===this.type?this.components.push([{x:n[e][0],y:n[e][1]}]):this.components.push({x:n[e][0],y:n[e][1]})}else this.components.push({x:n[0],y:n[1]});return this},o.Wkt.prototype.toJson=function(){var t,e,i,s,n,a,c;if(t=this.components,e={coordinates:[],type:function(){var t,e,o;for(t in e=this.regExes.ogcTypes.exec(this.type).slice(1),o=[],e)e.hasOwnProperty(t)&&void 0!==e[t]&&o.push(e[t].toLowerCase().slice(0,1).toUpperCase()+e[t].toLowerCase().slice(1));return o}.call(this).join("")},"box"===this.type.toLowerCase()){for(i in e.type="Polygon",e.bbox=[],t)t.hasOwnProperty(i)&&(e.bbox=e.bbox.concat([t[i].x,t[i].y]));return e.coordinates=[[[t[0].x,t[0].y],[t[0].x,t[1].y],[t[1].x,t[1].y],[t[1].x,t[0].y],[t[0].x,t[0].y]]],e}for(i in t)if(t.hasOwnProperty(i))if(o.isArray(t[i])){for(s in c=[],t[i])if(t[i].hasOwnProperty(s))if(o.isArray(t[i][s])){for(n in a=[],t[i][s])t[i][s].hasOwnProperty(n)&&a.push([t[i][s][n].x,t[i][s][n].y]);c.push(a)}else t[i].length>1?c.push([t[i][s].x,t[i][s].y]):c=c.concat([t[i][s].x,t[i][s].y]);e.coordinates.push(c)}else t.length>1?e.coordinates.push([t[i].x,t[i].y]):e.coordinates=e.coordinates.concat([t[i].x,t[i].y]);return e},o.Wkt.prototype.merge=function(t){var e=this.type.slice(0,5);if(this.type!==t.type&&this.type.slice(5,this.type.length)!==t.type)throw TypeError("The input geometry types must agree or the calling this.Wkt.Wkt instance must be a multigeometry of the other");switch(e){case"point":this.components=[this.components.concat(t.components)];break;case"multi":this.components=this.components.concat("multi"===t.type.slice(0,5)?t.components:[t.components]);break;default:this.components=[this.components,t.components];break}return"multi"!==e&&(this.type="multi"+this.type),this},o.Wkt.prototype.read=function(t){var e;if(e=this.regExes.typeStr.exec(t),e)this.type=e[1].toLowerCase(),this.base=e[2],this.ingest[this.type]&&(this.components=this.ingest[this.type].apply(this,[this.base]));else{if(!this.regExes.crudeJson.test(t))throw console.log("Invalid WKT string provided to read()"),{name:"WKTError",message:"Invalid WKT string provided to read()"};if("object"!==typeof JSON||"function"!==typeof JSON.parse)throw console.log("JSON.parse() is not available; cannot parse GeoJSON strings"),{name:"JSONError",message:"JSON.parse() is not available; cannot parse GeoJSON strings"};this.fromJson(JSON.parse(t))}return this},o.Wkt.prototype.write=function(t){var e,o,i;for(t=t||this.components,o=[],o.push(this.type.toUpperCase()+"("),e=0;e<t.length;e+=1){if(this.isCollection()&&e>0&&o.push(","),!this.extract[this.type])return null;i=this.extract[this.type].apply(this,[t[e]]),this.isCollection()&&"multipoint"!==this.type?o.push("("+i+")"):(o.push(i),e!==t.length-1&&"multipoint"!==this.type&&o.push(","))}return o.push(")"),o.join("")},o.Wkt.prototype.extract={point:function(t){return String(t.x)+this.delimiter+String(t.y)},multipoint:function(t){var e,o,i=[];for(e=0;e<t.length;e+=1)o=this.extract.point.apply(this,[t[e]]),this.wrapVertices&&(o="("+o+")"),i.push(o);return i.join(",")},linestring:function(t){return this.extract.point.apply(this,[t])},multilinestring:function(t){var e,o=[];if(t.length)for(e=0;e<t.length;e+=1)o.push(this.extract.linestring.apply(this,[t[e]]));else o.push(this.extract.point.apply(this,[t]));return o.join(",")},polygon:function(t){return this.extract.multilinestring.apply(this,[t])},multipolygon:function(t){var e,o=[];for(e=0;e<t.length;e+=1)o.push("("+this.extract.polygon.apply(this,[t[e]])+")");return o.join(",")},box:function(t){return this.extract.linestring.apply(this,[t])},geometrycollection:function(t){console.log("The geometrycollection WKT type is not yet supported.")}},o.Wkt.prototype.ingest={point:function(t){var e=o.trim(t).split(this.regExes.spaces);return[{x:parseFloat(this.regExes.numeric.exec(e[0])[0]),y:parseFloat(this.regExes.numeric.exec(e[1])[0])}]},multipoint:function(t){var e,i,s;for(i=[],s=o.trim(t).split(this.regExes.comma),e=0;e<s.length;e+=1)i.push(this.ingest.point.apply(this,[s[e]]));return i},linestring:function(t){var e,o,i;for(o=this.ingest.multipoint.apply(this,[t]),i=[],e=0;e<o.length;e+=1)i=i.concat(o[e]);return i},multilinestring:function(t){var e,i,s,n;for(i=[],n=o.trim(t).split(this.regExes.doubleParenComma),1===n.length&&(n=o.trim(t).split(this.regExes.parenComma)),e=0;e<n.length;e+=1)s=this._stripWhitespaceAndParens(n[e]),i.push(this.ingest.linestring.apply(this,[s]));return i},polygon:function(t){var e,i,s,n,a,c;for(c=o.trim(t).split(this.regExes.parenComma),s=[],e=0;e<c.length;e+=1){for(a=this._stripWhitespaceAndParens(c[e]).split(this.regExes.comma),n=[],i=0;i<a.length;i+=1){var r=a[i].split(this.regExes.spaces);if(r.length>2&&(r=r.filter((function(t){return""!=t}))),2===r.length){var u=r[0],p=r[1];n.push({x:parseFloat(u),y:parseFloat(p)})}}s.push(n)}return s},box:function(t){var e,o,i;for(o=this.ingest.multipoint.apply(this,[t]),i=[],e=0;e<o.length;e+=1)i=i.concat(o[e]);return i},multipolygon:function(t){var e,i,s,n;for(i=[],n=o.trim(t).split(this.regExes.doubleParenComma),e=0;e<n.length;e+=1)s=this._stripWhitespaceAndParens(n[e]),i.push(this.ingest.polygon.apply(this,[s]));return i},geometrycollection:function(t){console.log("The geometrycollection WKT type is not yet supported.")}},o}))},"464a":function(t,e,o){t.exports=o.p+"img/carbon_bus_w.21b33b66.svg"},"529f":function(t,e,o){t.exports=o.p+"img/walkbus.665fe3f1.svg"},"8fb6":function(t,e,o){"use strict";o.r(e);var i=o("7a23"),s=o("42f0"),n=o.n(s),a={class:"h-100 d-flex flex-column"},c={class:"bread-bar"},r={class:"breadcrumb m-0 d-md-flex d-none"},u=Object(i["f"])("li",{class:"breadcrumb-item"},[Object(i["f"])("a",{href:"#"},"首頁")],-1),p={class:"breadcrumb-item active","aria-current":"page"},l={class:"mobile-control-bar d-flex d-md-none"},h={class:"city"},f=Object(i["f"])("span",{class:"material-icons"}," location_on ",-1),m={class:"tool"},b=Object(i["f"])("i",{class:"bi bi-pin-map me-1"},null,-1),d=Object(i["g"])("地圖 "),O=[b,d],y=Object(i["f"])("i",{class:"bi bi-clock me-1"},null,-1),g=Object(i["g"])("時刻表 "),j=[y,g],v=Object(i["f"])("i",{class:"bi bi-map me-1"},null,-1),S=Object(i["g"])("路線 "),k=[v,S],w={class:"map-wrap"},x={class:"route-search-area active"},P={class:"route-search-header"},T={class:"route-search-body"},R={class:"route-list"},L=["onClick"],N={class:"d-flex justify-content-between"},C={class:"title"},E=Object(i["f"])("div",{class:"icon"},[Object(i["f"])("a",{href:"#"},[Object(i["f"])("span",{class:"material-icons"}," favorite_border ")])],-1),D={class:"d-flex justify-content-between"},A={class:"od"},J={class:"city"},z={class:"route-stop-area"},I=Object(i["f"])("span",{class:"material-icons"},"chevron_left",-1),B=Object(i["g"])(" 返回搜尋"),W=[I,B],_={class:"refresh-bar"},M=Object(i["f"])("span",{class:"material-icons"},"autorenew",-1),U=Object(i["g"])(" 立即更新 "),$=[M,U],q={class:"route-stop-header"},F={class:"route-name"},Z={class:"nav nav-tabs",role:"tablist"},G={class:"nav-item od-nav",role:"presentation"},K={key:0,class:"fw-700 truncateText"},H={class:"nav-item od-nav",role:"presentation"},V={key:0,class:"fw-700 truncateText"},Q={class:"route-stop-content"},X={class:"tab-content py-3",id:"routeTabContent"},Y={key:0,class:"tab-pane fade show active",id:"go",role:"tabpanel"},tt={class:"route-stop-list"},et=["onClick"],ot={key:0},it={key:0},st={key:1},nt={key:2},at={key:1},ct={key:2},rt={key:3},ut={key:4},pt={class:"stop-name"},lt={class:"plate-numb"},ht={key:0},ft={key:1,class:"tab-pane fade",id:"back",role:"tabpanel"},mt={class:"route-stop-list"},bt=["onClick"],dt={key:0},Ot={key:0},yt={key:1},gt={key:2},jt={key:1},vt={key:2},St={key:3},kt={key:4},wt={class:"plate-numb"},xt={key:0},Pt=Object(i["f"])("img",{src:n.a,class:"icon-filter",alt:"gps-icon"},null,-1),Tt=[Pt],Rt=Object(i["f"])("div",{class:"map",id:"map"},null,-1);function Lt(t,e,o,s,n,b){return Object(i["s"])(),Object(i["e"])("div",a,[Object(i["f"])("div",c,[Object(i["f"])("ol",r,[u,Object(i["f"])("li",p,Object(i["z"])(n.city),1)]),Object(i["f"])("div",l,[Object(i["f"])("div",h,[f,Object(i["g"])(Object(i["z"])(n.city),1)]),Object(i["f"])("div",m,[Object(i["f"])("div",{class:Object(i["n"])(["map",{active:"map"===n.mobileTool}]),onClick:e[0]||(e[0]=function(t){return b.showArea("map")})},O,2),n.stopOfRouteBack.length>0&&n.stopOfRouteTo.length>0?(Object(i["s"])(),Object(i["e"])("div",{key:0,class:Object(i["n"])(["time",{active:"time"===n.mobileTool}]),onClick:e[1]||(e[1]=function(t){return b.showArea("time")})},j,2)):Object(i["d"])("",!0),Object(i["f"])("div",{class:Object(i["n"])(["route",{active:"route"===n.mobileTool}]),onClick:e[2]||(e[2]=function(t){return b.showArea("route")})},k,2)])])]),Object(i["f"])("div",w,[Object(i["f"])("div",x,[Object(i["f"])("div",P,[Object(i["E"])(Object(i["f"])("input",{type:"search",class:"form-control",id:"routeNumber",placeholder:"請輸入公車路線","onUpdate:modelValue":e[3]||(e[3]=function(t){return n.routeKeyword=t}),onKeyup:e[4]||(e[4]=function(t){return b.getRoute()})},null,544),[[i["B"],n.routeKeyword]])]),Object(i["f"])("div",T,[Object(i["f"])("ul",R,[(Object(i["s"])(!0),Object(i["e"])(i["a"],null,Object(i["w"])(n.routeList,(function(t){return Object(i["s"])(),Object(i["e"])("li",{class:"route-list-item",key:t.RouteUID,onClick:function(e){return b.toRouteDetail(t.RouteName.Zh_tw,t.RouteUID)}},[Object(i["f"])("div",N,[Object(i["f"])("div",C,Object(i["z"])(t.RouteName.Zh_tw),1),E]),Object(i["f"])("div",D,[Object(i["f"])("div",A,Object(i["z"])(t.DepartureStopNameZh)+"-"+Object(i["z"])(t.DestinationStopNameZh),1),Object(i["f"])("div",J,Object(i["z"])(n.city),1)])],8,L)})),128))])])]),Object(i["f"])("div",z,[Object(i["f"])("a",{href:"#",class:"return",onClick:e[5]||(e[5]=Object(i["F"])((function(t){return b.backToRouteSeachList()}),["prevent"]))},W),Object(i["f"])("div",_,[Object(i["f"])("a",{href:"#",class:"refresh ms-auto",onClick:e[6]||(e[6]=Object(i["F"])((function(t){return b.getStopOfRoute()}),["prevent"]))},$)]),Object(i["f"])("div",q,[Object(i["f"])("div",F,Object(i["z"])(n.selectRoute),1)]),Object(i["f"])("ul",Z,[Object(i["f"])("li",G,[Object(i["f"])("button",{class:Object(i["n"])(["nav-link",{active:"to"===n.toOrBack}]),id:"go-tab","data-bs-toggle":"tab","data-bs-target":"#go",type:"button",onClick:e[7]||(e[7]=function(t){return b.changeToOrBack("to")})},[n.stopOfRouteTo.length>0?(Object(i["s"])(),Object(i["e"])("div",K,"往 "+Object(i["z"])(n.stopOfRouteTo[n.stopOfRouteTo.length-1].StopName.Zh_tw),1)):Object(i["d"])("",!0)],2)]),Object(i["f"])("li",H,[Object(i["f"])("button",{class:Object(i["n"])(["nav-link",{active:"back"===n.toOrBack}]),id:"back-tab","data-bs-toggle":"tab","data-bs-target":"#back",type:"button",onClick:e[8]||(e[8]=function(t){return b.changeToOrBack("back")})},[n.stopOfRouteBack.length>0?(Object(i["s"])(),Object(i["e"])("div",V,"往 "+Object(i["z"])(n.stopOfRouteBack[n.stopOfRouteBack.length-1].StopName.Zh_tw),1)):Object(i["d"])("",!0)],2)])]),Object(i["f"])("div",Q,[Object(i["f"])("div",X,[n.stopOfRouteTo.length>0?(Object(i["s"])(),Object(i["e"])("div",Y,[Object(i["f"])("ul",tt,[(Object(i["s"])(!0),Object(i["e"])(i["a"],null,Object(i["w"])(n.stopOfRouteTo,(function(e){return Object(i["s"])(),Object(i["e"])("li",{class:"route-stop-item",key:e.StopUID,onClick:function(t){return b.panToPosition(e.StopPosition.PositionLat,e.StopPosition.PositionLon)}},[Object(i["f"])("div",{class:Object(i["n"])(["time",{active:e.EstimateTime<=180,disconnect:0!==e.StopStatus}])},[0===e.StopStatus?(Object(i["s"])(),Object(i["e"])("span",ot,[e.EstimateTime<=180&&e.PlateNumb?(Object(i["s"])(),Object(i["e"])("span",it,"進站中")):e.EstimateTime<=180?(Object(i["s"])(),Object(i["e"])("span",st,"即將進站")):(Object(i["s"])(),Object(i["e"])("span",nt,Object(i["z"])(t.$filters.toMinute(e.EstimateTime))+"分",1))])):1===e.StopStatus?(Object(i["s"])(),Object(i["e"])("span",at,"尚未發車")):2===e.StopStatus?(Object(i["s"])(),Object(i["e"])("span",ct,"交管不停靠")):3===e.StopStatus?(Object(i["s"])(),Object(i["e"])("span",rt,"末班車已過")):(Object(i["s"])(),Object(i["e"])("span",ut,"今日未營運"))],2),Object(i["f"])("div",pt,Object(i["z"])(e.StopName.Zh_tw),1),Object(i["f"])("div",lt,[e.PlateNumb?(Object(i["s"])(),Object(i["e"])("span",ht,Object(i["z"])(e.PlateNumb),1)):Object(i["d"])("",!0)]),Object(i["f"])("div",{class:Object(i["n"])(["status-dot",{"bus-on":e.PlateNumb}])},null,2)],8,et)})),128))])])):Object(i["d"])("",!0),n.stopOfRouteBack.length>0?(Object(i["s"])(),Object(i["e"])("div",ft,[Object(i["f"])("ul",mt,[(Object(i["s"])(!0),Object(i["e"])(i["a"],null,Object(i["w"])(n.stopOfRouteBack,(function(e){return Object(i["s"])(),Object(i["e"])("li",{class:"route-stop-item",key:e.StopUID,onClick:function(t){return b.panToPosition(e.StopPosition.PositionLat,e.StopPosition.PositionLon)}},[Object(i["f"])("div",{class:Object(i["n"])(["time",{active:e.EstimateTime<=180,disconnect:0!==e.StopStatus}])},[0===e.StopStatus?(Object(i["s"])(),Object(i["e"])("span",dt,[e.EstimateTime<=180&&e.PlateNumb?(Object(i["s"])(),Object(i["e"])("span",Ot,"進站中")):e.EstimateTime<=180?(Object(i["s"])(),Object(i["e"])("span",yt,"即將進站")):(Object(i["s"])(),Object(i["e"])("span",gt,Object(i["z"])(t.$filters.toMinute(e.EstimateTime))+"分",1))])):1===e.StopStatus?(Object(i["s"])(),Object(i["e"])("span",jt,"尚未發車")):2===e.StopStatus?(Object(i["s"])(),Object(i["e"])("span",vt,"交管不停靠")):3===e.StopStatus?(Object(i["s"])(),Object(i["e"])("span",St,"末班車已過")):(Object(i["s"])(),Object(i["e"])("span",kt,"今日未營運"))],2),Object(i["f"])("div",{class:Object(i["n"])(["stop-name",{active:e.PlateNumb,disconnect:0!==e.StopStatus}])},Object(i["z"])(e.StopName.Zh_tw),3),Object(i["f"])("div",wt,[e.PlateNumb?(Object(i["s"])(),Object(i["e"])("span",xt,Object(i["z"])(e.PlateNumb),1)):Object(i["d"])("",!0)]),Object(i["f"])("div",{class:Object(i["n"])(["status-dot",{"bus-on":e.PlateNumb,"bus-close":e.EstimateTime<=180}])},null,2)],8,bt)})),128))])])):Object(i["d"])("",!0)])])]),Object(i["f"])("div",{class:"gps-icon",onClick:e[9]||(e[9]=function(t){return b.locateGPS()})},Tt),Rt])])}o("99af"),o("d3b7"),o("159b"),o("e9c4"),o("d81d");var Nt=o("e11e"),Ct=o.n(Nt),Et=o("11343"),Dt=o.n(Et),At={},Jt=new Ct.a.Icon({iconUrl:o("529f"),iconSize:[40,40],iconAnchor:[20,20],popupAnchor:[0,-20]}),zt=new Ct.a.Icon({iconUrl:o("0168"),iconSize:[28,28],iconAnchor:[14,14],popupAnchor:[0,-14]}),It=new Ct.a.Icon({iconUrl:o("fc97"),iconSize:[24,24],iconAnchor:[12,12],popupAnchor:[0,-12]}),Bt=new Ct.a.Icon({iconUrl:o("e275"),iconSize:[49,49],iconAnchor:[24,24],popupAnchor:[0,-24]}),Wt={data:function(){return{city:"",routeList:[],routeKeyword:"",stopOfRouteTo:[],stopOfRouteBack:[],selectRoute:"",selectRouteUID:"",toOrBack:"to",routeGeometry:[],locationMarkerID:"",walkBusMarker:[],stopMarker:[],mobileTool:"route"}},methods:{getRoute:function(){var t=this,e="https://ptx.transportdata.tw/MOTC/v2/Bus/Route/City/".concat(this.city,"/").concat(this.routeKeyword,"?$top=50&$format=JSON");this.axios.get(e,{headers:this.$getAuthorizationHeader()}).then((function(e){console.log(e.data),t.routeList=e.data})).catch((function(t){console.log(t)}))},toRouteDetail:function(t,e){document.querySelector(".route-search-area").classList.remove("active"),document.querySelector(".route-stop-area").classList.add("active"),this.selectRoute=t,this.selectRouteUID=e,this.mobileTool="time",this.getStopOfRoute()},backToRouteSeachList:function(){document.querySelector(".route-search-area").classList.add("active"),document.querySelector(".route-stop-area").classList.remove("active")},getStopOfRoute:function(){var t=this,e="https://ptx.transportdata.tw/MOTC/v2/Bus/StopOfRoute/City/".concat(this.city,"?$filter=RouteUID%20eq%20'").concat(this.selectRouteUID,"'&$format=JSON");this.axios.get(e,{headers:this.$getAuthorizationHeader()}).then((function(e){e.data.forEach((function(e){0===e.Direction?t.stopOfRouteTo=e.Stops:1===e.Direction&&(t.stopOfRouteBack=e.Stops)})),t.getEstimateTime(t.selectRoute,t.selectRouteUID)})).catch((function(t){console.log(t)}))},getEstimateTime:function(t,e){var o=this,i="https://ptx.transportdata.tw/MOTC/v2/Bus/EstimatedTimeOfArrival/City/".concat(this.city,"/").concat(t,"?$filter=RouteUID%20in%20('").concat(e,"')&$format=JSON");this.axios.get(i,{headers:this.$getAuthorizationHeader()}).then((function(i){console.log(i.data),i.data.forEach((function(t){0===t.Direction&&o.stopOfRouteTo.forEach((function(e){t.StopUID===e.StopUID&&(e.EstimateTime=t.EstimateTime,e.StopStatus=t.StopStatus)})),1===t.Direction&&o.stopOfRouteBack.forEach((function(e){t.StopUID===e.StopUID&&(e.EstimateTime=t.EstimateTime,e.StopStatus=t.StopStatus)}))})),o.getPlateNum(t,e)})).catch((function(t){console.log(t)}))},getPlateNum:function(t,e){var o=this,i="https://ptx.transportdata.tw/MOTC/v2/Bus/RealTimeNearStop/City/".concat(this.city,"/").concat(t,"?$filter=RouteUID%20eq%20'").concat(e,"'&$format=JSON");this.axios.get(i,{headers:this.$getAuthorizationHeader()}).then((function(i){console.log(i.data),i.data.forEach((function(t){0===t.Direction&&o.stopOfRouteTo.forEach((function(e){t.StopUID===e.StopUID&&(e.PlateNumb=t.PlateNumb)})),1===t.Direction&&o.stopOfRouteBack.forEach((function(e){t.StopUID===e.StopUID&&(e.PlateNumb=t.PlateNumb)}))})),o.getRouteGeometry(t,e)})).catch((function(t){console.log(t)}))},getRouteGeometry:function(t,e){var o=this,i="https://ptx.transportdata.tw/MOTC/v2/Bus/Shape/City/".concat(this.city,"/").concat(t,"?$filter=RouteUID%20eq%20'").concat(e,"'&$format=JSON");this.axios.get(i,{headers:this.$getAuthorizationHeader()}).then((function(t){console.log(t.data),o.routeGeometry=t.data,At.eachLayer((function(t){t._leaflet_id!==o.locationMarkerID&&(t instanceof Ct.a.Marker&&At.removeLayer(t),t instanceof Ct.a.Popup&&At.removeLayer(t))})),o.addRouteLayer()})).catch((function(t){console.log(t)}))},addRouteLayer:function(){var t=this,e={color:"#345E8A",weight:4},o=null;this.routeGeometry.forEach((function(i){var s=new Dt.a.Wkt;s.read(i.Geometry);var n=s.toJson();try{o=Ct.a.geoJSON(n,{style:e}).addTo(At),o.addData(n),t.addRouteMarker()}catch(a){console.log(a)}}))},changeToOrBack:function(t){this.toOrBack=t,this.addRouteMarker()},addRouteMarker:function(){var t=this,e=[];e="to"===this.toOrBack?JSON.parse(JSON.stringify(this.stopOfRouteTo)):JSON.parse(JSON.stringify(this.stopOfRouteBack)),At.eachLayer((function(e){e._leaflet_id!==t.locationMarkerID&&(e instanceof Ct.a.Marker&&At.removeLayer(e),e instanceof Ct.a.Popup&&At.removeLayer(e))}));var o=At.getZoom();o>15?this.zoomLevelAddMarker():e.forEach((function(t,o){if(t.PlateNumb){var i=Ct.a.marker([t.StopPosition.PositionLat,t.StopPosition.PositionLon],{icon:Jt});i.addTo(At)}else if(0===o||o===e.length-1){var s=Ct.a.marker([t.StopPosition.PositionLat,t.StopPosition.PositionLon],{icon:It});s.addTo(At)}}))},zoomLevelAddMarker:function(){var t=this;if(this.stopOfRouteTo.length>0&&this.stopOfRouteBack.length>0){var e=At.getZoom();if(console.log(e),e<=15)this.addRouteMarker();else{var o=[];o="to"===this.toOrBack?JSON.parse(JSON.stringify(this.stopOfRouteTo)):JSON.parse(JSON.stringify(this.stopOfRouteBack)),At.eachLayer((function(e){e._leaflet_id!==t.locationMarkerID&&(e instanceof Ct.a.Marker&&At.removeLayer(e),e instanceof Ct.a.Popup&&At.removeLayer(e))})),o.forEach((function(e,o){var i=t.createPopupContent(e),s=Ct.a.popup({autoPan:!1,className:i.status,offset:[0,-12]});if(s.setLatLng(Ct.a.latLng(e.StopPosition.PositionLat,e.StopPosition.PositionLon)),s.setContent(i.str),At.addLayer(s),"popupWarning"===i.status){var n=Ct.a.marker([e.StopPosition.PositionLat,e.StopPosition.PositionLon],{icon:zt}).bindPopup(s);n.addTo(At)}else{var a=Ct.a.marker([e.StopPosition.PositionLat,e.StopPosition.PositionLon],{icon:It}).bindPopup(s);a.addTo(At)}}))}}},createPopupContent:function(t){var e="",i="popupPrimary";0===t.StopStatus?t.EstimateTime<=180&&t.PlateNumb?(e="進站中",i="popupWarning"):t.EstimateTime<=180?(e="即將進站",i="popupWarning"):e=this.$filters.toMinute(t.EstimateTime)+" 分":1===t.StopStatus?(e="尚未發車",i="popupSecondary"):2===t.StopStatus?(e="交管不停靠",i="popupSecondary"):3===t.StopStatus&&(e="末班車已過",i="popupSecondary");var s=o("464a"),n=t.PlateNumb?'<img src="'.concat(s,'" height="25" alt="icon">'):"",a='\n      <div class="stop-popup">\n        '.concat(n,'\n        <div class="name">').concat(t.StopName.Zh_tw,'</div>\n        <div class="time">').concat(e," </div>\n      </div>\n      ");return{str:a,status:i}},panToPosition:function(t,e){At.setView([t,e],18),window.innerWidth<768&&this.showArea("map")},locateGPS:function(){var t=this;navigator.geolocation.getCurrentPosition((function(e){At.eachLayer((function(e){e._leaflet_id===t.locationMarkerID&&At.removeLayer(e)}));var o=[e.coords.latitude,e.coords.longitude];At.setView(o,15),document.querySelector(".gps-icon").classList.add("active");var i=Ct.a.marker([e.coords.latitude,e.coords.longitude],{icon:Bt});i.addTo(At),t.locationMarkerID=i._leaflet_id}))},showArea:function(t){"map"===t?(this.mobileTool="map",document.querySelector(".route-search-area").classList.remove("active"),document.querySelector(".route-stop-area").classList.remove("active")):"route"===t?(this.mobileTool="route",document.querySelector(".route-search-area").classList.add("active"),document.querySelector(".route-stop-area").classList.remove("active")):"time"===t&&(this.mobileTool="time",document.querySelector(".route-search-area").classList.remove("active"),document.querySelector(".route-stop-area").classList.add("active"))}},mounted:function(){this.city=this.$route.params.city,At=Ct.a.map("map",{zoomControl:!1,center:[23.51357237187571,120.21110434230025],zoom:8,tap:!1}),Ct.a.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(At),Ct.a.control.zoom({position:"bottomright"}).addTo(At),At.on("moveend",(function(){document.querySelector(".gps-icon").classList.remove("active")}));var t=this.zoomLevelAddMarker;At.on("zoomend",(function(){t()}))}},_t=o("6b0d"),Mt=o.n(_t);const Ut=Mt()(Wt,[["render",Lt]]);e["default"]=Ut},e9c4:function(t,e,o){var i=o("23e7"),s=o("da84"),n=o("d066"),a=o("2ba4"),c=o("e330"),r=o("d039"),u=s.Array,p=n("JSON","stringify"),l=c(/./.exec),h=c("".charAt),f=c("".charCodeAt),m=c("".replace),b=c(1..toString),d=/[\uD800-\uDFFF]/g,O=/^[\uD800-\uDBFF]$/,y=/^[\uDC00-\uDFFF]$/,g=function(t,e,o){var i=h(o,e-1),s=h(o,e+1);return l(O,t)&&!l(y,s)||l(y,t)&&!l(O,i)?"\\u"+b(f(t,0),16):t},j=r((function(){return'"\\udf06\\ud834"'!==p("\udf06\ud834")||'"\\udead"'!==p("\udead")}));p&&i({target:"JSON",stat:!0,forced:j},{stringify:function(t,e,o){for(var i=0,s=arguments.length,n=u(s);i<s;i++)n[i]=arguments[i];var c=a(p,null,n);return"string"==typeof c?m(c,d,g):c}})}}]);
//# sourceMappingURL=chunk-2b8c25ec.e3d3d036.js.map