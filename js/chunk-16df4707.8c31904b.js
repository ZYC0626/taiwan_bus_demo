(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-16df4707"],{"04d1":function(t,e,a){var o=a("342f"),i=o.match(/firefox\/(\d+)/i);t.exports=!!i&&+i[1]},"159b":function(t,e,a){var o=a("da84"),i=a("fdbc"),n=a("785a"),s=a("17c2"),c=a("9112"),r=function(t){if(t&&t.forEach!==s)try{c(t,"forEach",s)}catch(e){t.forEach=s}};for(var l in i)i[l]&&r(o[l]&&o[l].prototype);r(n)},"17c2":function(t,e,a){"use strict";var o=a("b727").forEach,i=a("a640"),n=i("forEach");t.exports=n?[].forEach:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}},"414c":function(t,e,a){"use strict";a.r(e);a("caad"),a("2532");var o=a("7a23"),i=a("42f0"),n=a.n(i),s={class:"h-100 d-flex flex-column"},c={class:"bread-bar d-flex justify-content-between"},r=Object(o["h"])("ol",{class:"breadcrumb m-0"},[Object(o["h"])("li",{class:"breadcrumb-item"},[Object(o["h"])("a",{href:"#"},"首頁")]),Object(o["h"])("li",{class:"breadcrumb-item active","aria-current":"page"},"附近站牌")],-1),l={class:"mobile-control-bar d-flex d-md-none"},u={class:"tool"},d=Object(o["h"])("i",{class:"bi bi-pin-map me-1"},null,-1),h=Object(o["j"])("地圖 "),f=[d,h],b=Object(o["h"])("i",{class:"bi bi-clock me-1"},null,-1),p=Object(o["j"])("預估時間 "),m=[b,p],v=Object(o["h"])("i",{class:"bi bi-map me-1"},null,-1),O=Object(o["j"])("站牌 "),S=[v,O],j={class:"map-wrap"},g={class:"near-station-area active"},L=Object(o["h"])("div",{class:"near-station-header"},[Object(o["h"])("h4",{class:"fw-700 ms-1 mb-0"},"附近站牌")],-1),k={class:"near-station-body"},y={class:"near-station-list"},w=["onClick"],P={class:"info"},I={class:"tilte"},N={class:"stops"},D={class:"distance"},C=Object(o["h"])("span",{class:"material-icons"}," location_on ",-1),E={class:"estimate-near-area"},_=Object(o["h"])("span",{class:"material-icons"},"chevron_left",-1),M=Object(o["j"])(" 返回搜尋"),T=[_,M],x={class:"estimate-near-header"},A={class:"title"},U={class:"estimate-near-body"},R={class:"estimate-near-list"},q=["onClick"],Z={key:0},$={key:0},z={key:1},G={key:2},B={key:1},J={key:2},F={key:3},H={key:4},K=["onClick"],V={class:"title"},W={key:0,class:"way"},Q={key:1,class:"way"},X={class:"icon ms-auto"},Y=["onClick"],tt={key:0,class:"material-icons love"},et={key:1,class:"material-icons"},at={key:0},ot=Object(o["h"])("img",{src:n.a,class:"icon-filter",alt:"gps-icon"},null,-1),it=[ot],nt=Object(o["h"])("div",{class:"map",id:"map"},null,-1);function st(t,e,a,i,n,d){return Object(o["w"])(),Object(o["g"])("div",s,[Object(o["h"])("div",c,[r,Object(o["h"])("div",l,[Object(o["h"])("div",u,[Object(o["h"])("div",{class:Object(o["q"])(["map",{active:"map"===n.mobileTool}]),onClick:e[0]||(e[0]=function(t){return d.showArea("map")})},f,2),n.EstimateNearList.length>0?(Object(o["w"])(),Object(o["g"])("div",{key:0,class:Object(o["q"])(["time",{active:"time"===n.mobileTool}]),onClick:e[1]||(e[1]=function(t){return d.showArea("time")})},m,2)):Object(o["f"])("",!0),Object(o["h"])("div",{class:Object(o["q"])(["route",{active:"station"===n.mobileTool}]),onClick:e[2]||(e[2]=function(t){return d.showArea("station")})},S,2)])])]),Object(o["h"])("div",j,[Object(o["h"])("div",g,[L,Object(o["h"])("div",k,[Object(o["h"])("ul",y,[(Object(o["w"])(!0),Object(o["g"])(o["a"],null,Object(o["B"])(n.nearStationList,(function(t){return Object(o["w"])(),Object(o["g"])("li",{class:Object(o["q"])(["near-station-list-item",{active:t.StationUID===n.selectStationUID}]),key:t.StationID,onClick:function(e){return d.getNearStaionDetail(t)}},[Object(o["h"])("div",P,[Object(o["h"])("div",I,Object(o["G"])(t.StationName.Zh_tw),1),Object(o["h"])("div",N,Object(o["G"])(t.Stops.length)+" 個站牌",1)]),Object(o["h"])("div",D,[C,Object(o["j"])(" "+Object(o["G"])(t.distanceFromLocation)+"m ",1)])],10,w)})),128))])])]),Object(o["h"])("div",E,[Object(o["h"])("a",{href:"#",class:"return",onClick:e[3]||(e[3]=Object(o["O"])((function(t){return d.backToNearStationList()}),["prevent"]))},T),Object(o["h"])("div",x,[Object(o["h"])("div",A,Object(o["G"])(n.selectStationName),1)]),Object(o["h"])("div",U,[Object(o["h"])("ul",R,[(Object(o["w"])(!0),Object(o["g"])(o["a"],null,Object(o["B"])(n.EstimateNearList,(function(e){return Object(o["w"])(),Object(o["g"])("li",{class:"estimate-near-list-item",key:e.StopUID},[Object(o["h"])("div",{class:Object(o["q"])(["time",{active:e.EstimateTime<=180,disconnect:0!==e.StopStatus}]),onClick:function(t){return d.toRouteDetail(e)}},[0===e.StopStatus?(Object(o["w"])(),Object(o["g"])("span",Z,[e.EstimateTime<=180&&e.PlateNumb?(Object(o["w"])(),Object(o["g"])("span",$,"進站中")):e.EstimateTime<=180?(Object(o["w"])(),Object(o["g"])("span",z,"即將進站")):(Object(o["w"])(),Object(o["g"])("span",G,Object(o["G"])(t.$filters.toMinute(e.EstimateTime))+"分",1))])):1===e.StopStatus?(Object(o["w"])(),Object(o["g"])("span",B,"尚未發車")):2===e.StopStatus?(Object(o["w"])(),Object(o["g"])("span",J,"交管不停靠")):3===e.StopStatus?(Object(o["w"])(),Object(o["g"])("span",F,"末班車已過")):(Object(o["w"])(),Object(o["g"])("span",H,"今日未營運"))],10,q),Object(o["h"])("div",{class:"info",onClick:function(t){return d.toRouteDetail(e)}},[Object(o["h"])("div",V,Object(o["G"])(e.RouteName.Zh_tw),1),0===e.Direction?(Object(o["w"])(),Object(o["g"])("div",W,"往 "+Object(o["G"])(e.DestinationStopNameZh),1)):(Object(o["w"])(),Object(o["g"])("div",Q,"往 "+Object(o["G"])(e.DepartureStopNameZh),1))],8,K),Object(o["h"])("div",X,[Object(o["h"])("a",{href:"#",onClick:Object(o["O"])((function(t){return d.updateLikes(e)}),["prevent"])},[n.buslikesId.includes(e.RouteUID)?(Object(o["w"])(),Object(o["g"])("span",tt," favorite ")):(Object(o["w"])(),Object(o["g"])("span",et," favorite_border "))],8,Y),e.City?(Object(o["w"])(),Object(o["g"])("span",at,Object(o["G"])(t.$filters.replaceCity(e.City)),1)):Object(o["f"])("",!0)])])})),128))])])]),Object(o["h"])("div",{class:"gps-icon",onClick:e[4]||(e[4]=function(t){return d.locateGPS()})},it),nt])])}a("99af"),a("d3b7"),a("159b"),a("4e82"),a("e9c4"),a("d81d"),a("a434");var ct=a("e11e"),rt=a.n(ct),lt={},ut=new rt.a.Icon({iconUrl:a("fc97"),iconSize:[24,24],iconAnchor:[12,12],popupAnchor:[0,-12]}),dt=new rt.a.Icon({iconUrl:a("56a7"),iconSize:[24,24],iconAnchor:[12,12],popupAnchor:[0,-12]}),ht=new rt.a.Icon({iconUrl:a("e275"),iconSize:[49,49],iconAnchor:[24,24],popupAnchor:[0,-24]}),ft={data:function(){return{locationMarkerID:"",nearStationList:[],stationMarkers:[],lastSelectLatLon:[0,0],EstimateNearList:[],selectStationName:"",selectStationUID:"",selectStationLatLon:[],mobileTool:"station",buslikes:[],buslikesId:[]}},methods:{locateGPS:function(){var t=this;navigator.geolocation.getCurrentPosition((function(e){lt.eachLayer((function(e){e._leaflet_id===t.locationMarkerID&&lt.removeLayer(e)}));var a=[e.coords.latitude,e.coords.longitude];lt.setView(a,15),document.querySelector(".gps-icon").classList.add("active");var o=rt.a.marker([e.coords.latitude,e.coords.longitude],{icon:ht});o.addTo(lt),t.locationMarkerID=o._leaflet_id,t.getNearbyStation(e.coords.latitude,e.coords.longitude)}))},getNearbyStation:function(t,e){var a=this,o="https://ptx.transportdata.tw/MOTC/v2/Bus/Station/NearBy?$spatialFilter=nearby(".concat(t,"%2C%20").concat(e,"%2C%201000)&$format=JSON");console.log("目前位置",t,e),this.axios.get(o,{headers:this.$getAuthorizationHeader()}).then((function(o){a.nearStationList=o.data,a.nearStationList.forEach((function(a){var o=lt.distance([t,e],[a.StationPosition.PositionLat,a.StationPosition.PositionLon]);a.distanceFromLocation=Math.floor(o)})),a.nearStationList.sort((function(t,e){return t.distanceFromLocation-e.distanceFromLocation})),a.addNearStationMarker()})).catch((function(t){console.log(t)}))},addNearStationMarker:function(){var t=this;lt.eachLayer((function(e){e._leaflet_id!==t.locationMarkerID&&(e instanceof rt.a.Marker&&lt.removeLayer(e),e instanceof rt.a.Popup&&lt.removeLayer(e))})),this.nearStationList.forEach((function(e,a){var o=t.createPopupContent(e),i=rt.a.popup({autoPan:!1,className:o.status,offset:[0,-5]});i.setLatLng(rt.a.latLng(e.StationPosition.PositionLat,e.StationPosition.PositionLon)),i.setContent(o.str);var n=rt.a.marker([e.StationPosition.PositionLat,e.StationPosition.PositionLon],{icon:ut}).bindPopup(i);n.addTo(lt),e.markerID=n._leaflet_id,t.stationMarkers.push(n)}))},getNearStaionDetail:function(t){var e=this;lt.setView([t.StationPosition.PositionLat,t.StationPosition.PositionLon],18),this.stationMarkers.forEach((function(t){t._latlng.lat===e.lastSelectLatLon[0]&&t._latlng.lng===e.lastSelectLatLon[1]&&t.setIcon(ut)})),this.stationMarkers.forEach((function(a){a._latlng.lat===t.StationPosition.PositionLat&&a._latlng.lng===t.StationPosition.PositionLon&&(a.setIcon(dt),e.lastSelectLatLon=[a._latlng.lat,a._latlng.lng])})),lt.eachLayer((function(t){t._leaflet_id!==e.locationMarkerID&&t instanceof rt.a.Popup&&lt.removeLayer(t)}));var a=this.createPopupContent(t),o=rt.a.popup({autoPan:!1,className:"popupSelect",offset:[0,-5]});o.setLatLng(rt.a.latLng(t.StationPosition.PositionLat,t.StationPosition.PositionLon)),o.setContent(a.str),lt.addLayer(o),this.getEstimatedTimeOfArrival(t),document.querySelector(".near-station-area").classList.remove("active"),document.querySelector(".estimate-near-area").classList.add("active")},zoomLevelAddMarker:function(){var t=this,e=lt.getZoom();e<=16?this.addNearStationMarker():(lt.eachLayer((function(e){e._leaflet_id!==t.locationMarkerID&&e instanceof rt.a.Popup&&lt.removeLayer(e)})),this.nearStationList.forEach((function(e,a){var o=t.createPopupContent(e),i=rt.a.popup({autoPan:!1,className:o.status,offset:[0,-5]});i.setLatLng(rt.a.latLng(e.StationPosition.PositionLat,e.StationPosition.PositionLon)),i.setContent(o.str),lt.addLayer(i)})))},createPopupContent:function(t){var e="popupPrimary",a='\n      <div class="stop-popup">\n        <div class="name">'.concat(t.StationName.Zh_tw,"</div>\n      </div>\n      ");return{str:a,status:e}},getEstimatedTimeOfArrival:function(t){var e=this;this.EstimateNearList=[];var a="https://ptx.transportdata.tw/MOTC/v2/Bus/EstimatedTimeOfArrival/NearBy?$spatialFilter=nearby(".concat(t.StationPosition.PositionLat,"%2C%20").concat(t.StationPosition.PositionLon,"%2C%201000)&$format=JSON");this.axios.get(a,{headers:this.$getAuthorizationHeader()}).then((function(a){t.Stops.forEach((function(t){a.data.forEach((function(a){t.StopUID===a.StopUID&&e.EstimateNearList.push(a)}))})),e.getRouteInfo(t)})).catch((function(t){console.log(t)}))},getRouteInfo:function(t){var e=this,a="https://ptx.transportdata.tw/MOTC/v2/Bus/Route/NearBy?$spatialFilter=nearby(".concat(t.StationPosition.PositionLat,"%2C%20").concat(t.StationPosition.PositionLon,"%2C%201000)&$format=JSON");this.axios.get(a,{headers:this.$getAuthorizationHeader()}).then((function(a){e.EstimateNearList.forEach((function(t){a.data.forEach((function(e){t.RouteUID===e.RouteUID&&(t.DepartureStopNameZh=e.DepartureStopNameZh,t.DestinationStopNameZh=e.DestinationStopNameZh,t.City=e.City)}))})),e.EstimateNearList.sort((function(t,e){return t.RouteName.Zh_tw-e.RouteName.Zh_tw})),e.selectStationName=t.StationName.Zh_tw,e.selectStationUID=t.StationUID,e.selectStationLatLon=[t.StationPosition.PositionLat,t.StationPosition.PositionLon]})).catch((function(t){console.log(t)}))},backToNearStationList:function(){document.querySelector(".near-station-area").classList.add("active"),document.querySelector(".estimate-near-area").classList.remove("active")},showArea:function(t){"map"===t?(this.mobileTool="map",document.querySelector(".near-station-area").classList.remove("active"),document.querySelector(".estimate-near-area").classList.remove("active")):"station"===t?(this.mobileTool="station",document.querySelector(".near-station-area").classList.add("active"),document.querySelector(".estimate-near-area").classList.remove("active")):"time"===t&&(this.mobileTool="time",document.querySelector(".near-station-area").classList.remove("active"),document.querySelector(".estimate-near-area").classList.add("active"))},toRouteDetail:function(t){console.log(t);var e={city:t.City,route:t.RouteName.Zh_tw,routeUID:t.RouteUID,direction:t.Direction,LatLon:this.selectStationLatLon},a=JSON.stringify(e);this.$router.push("/BusSearch/".concat(a))},getLikes:function(){var t=localStorage.getItem("busLikes")?localStorage.getItem("busLikes"):"[]";this.buslikes=JSON.parse(t),this.buslikesId=this.buslikes.map((function(t){return t.routeUID})),console.log(this.buslikesId)},updateLikes:function(t){var e={data:{data:{},message:"收藏",success:!0}};this.buslikesId.includes(t.RouteUID)?(this.buslikes.splice(this.buslikes.map((function(t){return t.routeUID})).indexOf(t.RouteUID),1),this.buslikesId.splice(this.buslikesId.indexOf(t.RouteUID),1),this.$httpMessageState(e,"移除收藏")):(this.buslikes.push({routeUID:t.RouteUID,routeName:t.RouteName.Zh_tw,start:t.DepartureStopNameZh,end:t.DestinationStopNameZh,city:t.City}),this.buslikesId.push(t.RouteUID),this.$httpMessageState(e,"加入收藏"))},saveLocalStorage:function(t){var e=JSON.stringify(t);try{localStorage.setItem("busLikes",e)}catch(a){return!1}}},watch:{buslikes:{handler:function(t,e){this.saveLocalStorage(this.buslikes)},deep:!0}},mounted:function(){lt=rt.a.map("map",{zoomControl:!1,center:[23.51357237187571,120.21110434230025],zoom:8,tap:!1}),rt.a.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(lt),rt.a.control.zoom({position:"bottomright"}).addTo(lt),lt.on("moveend",(function(){document.querySelector(".gps-icon").classList.remove("active")}));var t=this.zoomLevelAddMarker;lt.on("zoomend",(function(){t()})),this.locateGPS(),this.getLikes()}},bt=a("6b0d"),pt=a.n(bt);const mt=pt()(ft,[["render",st]]);e["default"]=mt},"4e82":function(t,e,a){"use strict";var o=a("23e7"),i=a("e330"),n=a("59ed"),s=a("7b0b"),c=a("07fa"),r=a("577e"),l=a("d039"),u=a("addb"),d=a("a640"),h=a("04d1"),f=a("d998"),b=a("2d00"),p=a("512c"),m=[],v=i(m.sort),O=i(m.push),S=l((function(){m.sort(void 0)})),j=l((function(){m.sort(null)})),g=d("sort"),L=!l((function(){if(b)return b<70;if(!(h&&h>3)){if(f)return!0;if(p)return p<603;var t,e,a,o,i="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:a=3;break;case 68:case 71:a=4;break;default:a=2}for(o=0;o<47;o++)m.push({k:e+o,v:a})}for(m.sort((function(t,e){return e.v-t.v})),o=0;o<m.length;o++)e=m[o].k.charAt(0),i.charAt(i.length-1)!==e&&(i+=e);return"DGBEFHACIJK"!==i}})),k=S||!j||!g||!L,y=function(t){return function(e,a){return void 0===a?-1:void 0===e?1:void 0!==t?+t(e,a)||0:r(e)>r(a)?1:-1}};o({target:"Array",proto:!0,forced:k},{sort:function(t){void 0!==t&&n(t);var e=s(this);if(L)return void 0===t?v(e):v(e,t);var a,o,i=[],r=c(e);for(o=0;o<r;o++)o in e&&O(i,e[o]);u(i,y(t)),a=i.length,o=0;while(o<a)e[o]=i[o++];while(o<r)delete e[o++];return e}})},"512c":function(t,e,a){var o=a("342f"),i=o.match(/AppleWebKit\/(\d+)\./);t.exports=!!i&&+i[1]},"56a7":function(t,e,a){t.exports=a.p+"img/bus_stop_select.dacbc18d.svg"},"99af":function(t,e,a){"use strict";var o=a("23e7"),i=a("da84"),n=a("d039"),s=a("e8b5"),c=a("861d"),r=a("7b0b"),l=a("07fa"),u=a("8418"),d=a("65f0"),h=a("1dde"),f=a("b622"),b=a("2d00"),p=f("isConcatSpreadable"),m=9007199254740991,v="Maximum allowed index exceeded",O=i.TypeError,S=b>=51||!n((function(){var t=[];return t[p]=!1,t.concat()[0]!==t})),j=h("concat"),g=function(t){if(!c(t))return!1;var e=t[p];return void 0!==e?!!e:s(t)},L=!S||!j;o({target:"Array",proto:!0,forced:L},{concat:function(t){var e,a,o,i,n,s=r(this),c=d(s,0),h=0;for(e=-1,o=arguments.length;e<o;e++)if(n=-1===e?s:arguments[e],g(n)){if(i=l(n),h+i>m)throw O(v);for(a=0;a<i;a++,h++)a in n&&u(c,h,n[a])}else{if(h>=m)throw O(v);u(c,h++,n)}return c.length=h,c}})},addb:function(t,e,a){var o=a("f36a"),i=Math.floor,n=function(t,e){var a=t.length,r=i(a/2);return a<8?s(t,e):c(t,n(o(t,0,r),e),n(o(t,r),e),e)},s=function(t,e){var a,o,i=t.length,n=1;while(n<i){o=n,a=t[n];while(o&&e(t[o-1],a)>0)t[o]=t[--o];o!==n++&&(t[o]=a)}return t},c=function(t,e,a,o){var i=e.length,n=a.length,s=0,c=0;while(s<i||c<n)t[s+c]=s<i&&c<n?o(e[s],a[c])<=0?e[s++]:a[c++]:s<i?e[s++]:a[c++];return t};t.exports=n},d998:function(t,e,a){var o=a("342f");t.exports=/MSIE|Trident/.test(o)},fc97:function(t,e,a){t.exports=a.p+"img/busStop.2fb86a4d.svg"}}]);
//# sourceMappingURL=chunk-16df4707.8c31904b.js.map