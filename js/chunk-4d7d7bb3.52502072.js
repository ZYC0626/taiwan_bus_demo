(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4d7d7bb3"],{"159b":function(t,e,a){var o=a("da84"),i=a("fdbc"),n=a("785a"),c=a("17c2"),s=a("9112"),r=function(t){if(t&&t.forEach!==c)try{s(t,"forEach",c)}catch(e){t.forEach=c}};for(var l in i)i[l]&&r(o[l]&&o[l].prototype);r(n)},"17c2":function(t,e,a){"use strict";var o=a("b727").forEach,i=a("a640"),n=i("forEach");t.exports=n?[].forEach:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}},"4de4":function(t,e,a){"use strict";var o=a("23e7"),i=a("b727").filter,n=a("1dde"),c=n("filter");o({target:"Array",proto:!0,forced:!c},{filter:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}})},"99af":function(t,e,a){"use strict";var o=a("23e7"),i=a("da84"),n=a("d039"),c=a("e8b5"),s=a("861d"),r=a("7b0b"),l=a("07fa"),u=a("8418"),d=a("65f0"),h=a("1dde"),f=a("b622"),b=a("2d00"),p=f("isConcatSpreadable"),g=9007199254740991,O="Maximum allowed index exceeded",m=i.TypeError,v=b>=51||!n((function(){var t=[];return t[p]=!1,t.concat()[0]!==t})),j=h("concat"),S=function(t){if(!s(t))return!1;var e=t[p];return void 0!==e?!!e:c(t)},y=!v||!j;o({target:"Array",proto:!0,forced:y},{concat:function(t){var e,a,o,i,n,c=r(this),s=d(c,0),h=0;for(e=-1,o=arguments.length;e<o;e++)if(n=-1===e?c:arguments[e],S(n)){if(i=l(n),h+i>g)throw m(O);for(a=0;a<i;a++,h++)a in n&&u(s,h,n[a])}else{if(h>=g)throw m(O);u(s,h++,n)}return s.length=h,s}})},e176:function(t,e,a){"use strict";a.r(e);a("caad"),a("2532");var o=a("7a23"),i=a("42f0"),n=a.n(i),c={class:"h-100 d-flex flex-column"},s=Object(o["i"])('<div class="bread-bar"><ol class="breadcrumb m-0"><li class="breadcrumb-item"><a href="#">首頁</a></li><li class="breadcrumb-item active" aria-current="page">站點查詢</li></ol></div>',1),r={class:"map-wrap"},l={class:"route-search-area active"},u={class:"route-search-header"},d=["value"],h={id:"datalistOptions"},f=["value"],b={class:"route-search-body"},p={class:"route-list"},g=["onClick"],O={class:"d-flex justify-content-between"},m={class:"title"},v={class:"icon"},j=["onClick"],S={key:0,class:"material-icons love"},y={key:1,class:"material-icons"},D={class:"d-flex justify-content-between"},k={class:"od"},w={class:"city"},I={key:0},R=Object(o["h"])("img",{src:n.a,class:"icon-filter",alt:"gps-icon"},null,-1),C=[R],N=Object(o["h"])("div",{class:"map",id:"map"},null,-1);function L(t,e,a,i,n,R){var L=Object(o["D"])("Loading");return Object(o["w"])(),Object(o["g"])(o["a"],null,[Object(o["k"])(L,{active:n.isLoading,"z-index":2e3},null,8,["active"]),Object(o["h"])("div",c,[s,Object(o["h"])("div",r,[Object(o["h"])("div",l,[Object(o["h"])("div",u,[Object(o["N"])(Object(o["h"])("select",{class:"form-select mb-2","onUpdate:modelValue":e[0]||(e[0]=function(t){return n.city=t}),onChange:e[1]||(e[1]=function(t){return R.getAllStationFromCity()})},[(Object(o["w"])(!0),Object(o["g"])(o["a"],null,Object(o["B"])(n.cityList,(function(t){return Object(o["w"])(),Object(o["g"])("option",{value:t.City,key:t.City},Object(o["G"])(t.CityName),9,d)})),128))],544),[[o["I"],n.city]]),Object(o["N"])(Object(o["h"])("input",{list:"datalistOptions",class:"form-control",id:"stationName",placeholder:"想去哪裡?","onUpdate:modelValue":e[2]||(e[2]=function(t){return n.selectStationName=t}),onChange:e[3]||(e[3]=function(t){return R.getStationData()})},null,544),[[o["J"],n.selectStationName]]),Object(o["h"])("datalist",h,[(Object(o["w"])(!0),Object(o["g"])(o["a"],null,Object(o["B"])(n.optiondata,(function(t,e){return Object(o["w"])(),Object(o["g"])("option",{value:t,key:e},null,8,f)})),128))])]),Object(o["h"])("div",b,[Object(o["h"])("ul",p,[(Object(o["w"])(!0),Object(o["g"])(o["a"],null,Object(o["B"])(n.selectRouteData,(function(e){return Object(o["w"])(),Object(o["g"])("li",{class:"route-list-item",key:e.RouteUID,onClick:function(t){return R.toRouteDetail(e)}},[Object(o["h"])("div",O,[Object(o["h"])("div",m,Object(o["G"])(e.RouteName.Zh_tw),1),Object(o["h"])("div",v,[Object(o["h"])("a",{href:"#",onClick:Object(o["O"])((function(t){return R.updateLikes(e)}),["prevent"])},[n.buslikesId.includes(e.RouteUID)?(Object(o["w"])(),Object(o["g"])("span",S," favorite ")):(Object(o["w"])(),Object(o["g"])("span",y," favorite_border "))],8,j)])]),Object(o["h"])("div",D,[Object(o["h"])("div",k,Object(o["G"])(e.DepartureStopNameZh)+"-"+Object(o["G"])(e.DestinationStopNameZh),1),Object(o["h"])("div",w,[e.City?(Object(o["w"])(),Object(o["g"])("span",I,Object(o["G"])(t.$filters.replaceCity(e.City)),1)):Object(o["f"])("",!0)])])],8,g)})),128))])])]),Object(o["h"])("div",{class:"gps-icon",onClick:e[4]||(e[4]=function(t){return R.locateGPS()})},C),N])])],64)}a("d81d"),a("4de4"),a("d3b7"),a("99af"),a("159b"),a("e9c4"),a("a434");var x=a("e11e"),U=a.n(x),$=a("cc8c"),A={},M=new U.a.Icon({iconUrl:a("e275"),iconSize:[49,49],iconAnchor:[24,24],popupAnchor:[0,-24]}),_={data:function(){return{isLoading:!1,locationMarkerID:"",optiondata:[],selectStationName:"",selectStationData:[],selectStationRouteID:[],selectRouteData:[],buslikes:[],buslikesId:[],city:"Taipei",cityList:$}},methods:{locateGPS:function(){var t=this;navigator.geolocation.getCurrentPosition((function(e){A.eachLayer((function(e){e._leaflet_id===t.locationMarkerID&&A.removeLayer(e)}));var a=[e.coords.latitude,e.coords.longitude];console.log(a),A.setView(a,15),document.querySelector(".gps-icon").classList.add("active");var o=U.a.marker([e.coords.latitude,e.coords.longitude],{icon:M});o.addTo(A),t.locationMarkerID=o._leaflet_id}))},getAllStationFromCity:function(){var t=this,e="https://ptx.transportdata.tw/MOTC/v2/Bus/Station/City/".concat(this.city,"?$select=StationName&$format=JSON");this.axios.get(e,{headers:this.$getAuthorizationHeader()}).then((function(e){t.optiondata=e.data.map((function(t){return t.StationName.Zh_tw})),t.optiondata=t.optiondata.filter((function(t,e,a){return a.indexOf(t)===e})),t.getStationData()})).catch((function(t){console.log(t)}))},getStationData:function(){var t=this,e="https://ptx.transportdata.tw/MOTC/v2/Bus/Station/City/".concat(this.city,"?$filter=StationName%2FZh_tw%20eq%20'").concat(this.selectStationName,"'&$format=JSON");this.axios.get(e,{headers:this.$getAuthorizationHeader()}).then((function(e){var a;t.selectStationData=e.data;var o=[];e.data.forEach((function(t){o.push(t.Stops.map((function(t){return t.RouteUID})))})),t.selectStationRouteID=(a=[]).concat.apply(a,o),t.selectStationRouteID=t.selectStationRouteID.filter((function(t,e,a){return a.indexOf(t)===e})),console.log(t.selectStationRouteID),t.getRouteData()})).catch((function(t){console.log(t)}))},getRouteData:function(){var t=this,e="https://ptx.transportdata.tw/MOTC/v2/Bus/Route/City/".concat(this.city,"?$format=JSON");this.axios.get(e,{headers:this.$getAuthorizationHeader()}).then((function(e){t.selectRouteData=e.data.filter((function(e){if(t.selectStationRouteID.includes(e.RouteUID))return e})),console.log(t.selectRouteData)})).catch((function(t){console.log(t)}))},toRouteDetail:function(t){if(console.log(t),"SPAN"!==event.target.tagName){var e={city:t.City,route:t.RouteName.Zh_tw,routeUID:t.RouteUID,direction:0,LatLon:[this.selectStationData[0].StationPosition.PositionLat,this.selectStationData[0].StationPosition.PositionLon]},a=JSON.stringify(e);this.$router.push("/BusSearch/".concat(a))}},getLikes:function(){var t=localStorage.getItem("busLikes")?localStorage.getItem("busLikes"):"[]";this.buslikes=JSON.parse(t),this.buslikesId=this.buslikes.map((function(t){return t.routeUID})),console.log(this.buslikesId)},updateLikes:function(t){var e={data:{data:{},message:"收藏",success:!0}};this.buslikesId.includes(t.RouteUID)?(this.buslikes.splice(this.buslikes.map((function(t){return t.routeUID})).indexOf(t.RouteUID),1),this.buslikesId.splice(this.buslikesId.indexOf(t.RouteUID),1),this.$httpMessageState(e,"移除收藏")):(this.buslikes.push({routeUID:t.RouteUID,routeName:t.RouteName.Zh_tw,start:t.DepartureStopNameZh,end:t.DestinationStopNameZh,city:t.City}),this.buslikesId.push(t.RouteUID),this.$httpMessageState(e,"加入收藏"))},saveLocalStorage:function(t){var e=JSON.stringify(t);try{localStorage.setItem("busLikes",e)}catch(a){return!1}}},watch:{buslikes:{handler:function(t,e){this.saveLocalStorage(this.buslikes)},deep:!0}},mounted:function(){A=U.a.map("map",{zoomControl:!1,center:[25.0834397,121.4570441],zoom:13,tap:!1}),U.a.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(A),U.a.control.zoom({position:"bottomright"}).addTo(A),A.on("moveend",(function(){document.querySelector(".gps-icon").classList.remove("active")})),this.locateGPS(),this.getLikes(),this.getAllStationFromCity()}},z=a("6b0d"),J=a.n(z);const P=J()(_,[["render",L]]);e["default"]=P}}]);
//# sourceMappingURL=chunk-4d7d7bb3.52502072.js.map