(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4d7d7bb3"],{"159b":function(t,e,o){var a=o("da84"),i=o("fdbc"),n=o("785a"),c=o("17c2"),s=o("9112"),r=function(t){if(t&&t.forEach!==c)try{s(t,"forEach",c)}catch(e){t.forEach=c}};for(var l in i)i[l]&&r(a[l]&&a[l].prototype);r(n)},"17c2":function(t,e,o){"use strict";var a=o("b727").forEach,i=o("a640"),n=i("forEach");t.exports=n?[].forEach:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}},"4de4":function(t,e,o){"use strict";var a=o("23e7"),i=o("b727").filter,n=o("1dde"),c=n("filter");a({target:"Array",proto:!0,forced:!c},{filter:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}})},"99af":function(t,e,o){"use strict";var a=o("23e7"),i=o("da84"),n=o("d039"),c=o("e8b5"),s=o("861d"),r=o("7b0b"),l=o("07fa"),u=o("8418"),d=o("65f0"),h=o("1dde"),f=o("b622"),b=o("2d00"),p=f("isConcatSpreadable"),g=9007199254740991,O="Maximum allowed index exceeded",m=i.TypeError,v=b>=51||!n((function(){var t=[];return t[p]=!1,t.concat()[0]!==t})),j=h("concat"),S=function(t){if(!s(t))return!1;var e=t[p];return void 0!==e?!!e:c(t)},y=!v||!j;a({target:"Array",proto:!0,forced:y},{concat:function(t){var e,o,a,i,n,c=r(this),s=d(c,0),h=0;for(e=-1,a=arguments.length;e<a;e++)if(n=-1===e?c:arguments[e],S(n)){if(i=l(n),h+i>g)throw m(O);for(o=0;o<i;o++,h++)o in n&&u(s,h,n[o])}else{if(h>=g)throw m(O);u(s,h++,n)}return s.length=h,s}})},e176:function(t,e,o){"use strict";o.r(e);o("caad"),o("2532");var a=o("7a23"),i=o("42f0"),n=o.n(i),c={class:"h-100 d-flex flex-column"},s=Object(a["i"])('<div class="bread-bar"><ol class="breadcrumb m-0"><li class="breadcrumb-item"><a href="#">首頁</a></li><li class="breadcrumb-item active" aria-current="page">站點查詢</li></ol></div>',1),r={class:"map-wrap"},l={class:"route-search-area active"},u={class:"route-search-header"},d=["value"],h={id:"datalistOptions"},f=["value"],b={class:"route-search-body"},p={class:"route-list"},g=["onClick"],O={class:"d-flex justify-content-between"},m={class:"title"},v={class:"icon"},j=["onClick"],S={key:0,class:"material-icons love"},y={key:1,class:"material-icons"},D={class:"d-flex justify-content-between"},k={class:"od"},I={class:"city"},w={key:0},R=Object(a["h"])("img",{src:n.a,class:"icon-filter",alt:"gps-icon"},null,-1),C=[R],N=Object(a["h"])("div",{class:"map",id:"map"},null,-1);function L(t,e,o,i,n,R){var L=Object(a["D"])("Loading");return Object(a["w"])(),Object(a["g"])(a["a"],null,[Object(a["k"])(L,{active:n.isLoading,"z-index":2e3},null,8,["active"]),Object(a["h"])("div",c,[s,Object(a["h"])("div",r,[Object(a["h"])("div",l,[Object(a["h"])("div",u,[Object(a["N"])(Object(a["h"])("select",{class:"form-select mb-2","onUpdate:modelValue":e[0]||(e[0]=function(t){return n.city=t}),onChange:e[1]||(e[1]=function(t){return R.getAllStationFromCity()})},[(Object(a["w"])(!0),Object(a["g"])(a["a"],null,Object(a["B"])(n.cityList,(function(t){return Object(a["w"])(),Object(a["g"])("option",{value:t.City,key:t.City},Object(a["G"])(t.CityName),9,d)})),128))],544),[[a["I"],n.city]]),Object(a["N"])(Object(a["h"])("input",{list:"datalistOptions",class:"form-control",id:"stationName",placeholder:"想去哪裡?","onUpdate:modelValue":e[2]||(e[2]=function(t){return n.selectStationName=t}),onChange:e[3]||(e[3]=function(t){return R.getStationData()})},null,544),[[a["J"],n.selectStationName]]),Object(a["h"])("datalist",h,[(Object(a["w"])(!0),Object(a["g"])(a["a"],null,Object(a["B"])(n.optiondata,(function(t,e){return Object(a["w"])(),Object(a["g"])("option",{value:t,key:e},null,8,f)})),128))])]),Object(a["h"])("div",b,[Object(a["h"])("ul",p,[(Object(a["w"])(!0),Object(a["g"])(a["a"],null,Object(a["B"])(n.selectRouteData,(function(e){return Object(a["w"])(),Object(a["g"])("li",{class:"route-list-item",key:e.RouteUID,onClick:function(t){return R.toRouteDetail(e)}},[Object(a["h"])("div",O,[Object(a["h"])("div",m,Object(a["G"])(e.RouteName.Zh_tw),1),Object(a["h"])("div",v,[Object(a["h"])("a",{href:"#",onClick:Object(a["O"])((function(t){return R.updateLikes(e)}),["prevent"])},[n.buslikesId.includes(e.RouteUID)?(Object(a["w"])(),Object(a["g"])("span",S," favorite ")):(Object(a["w"])(),Object(a["g"])("span",y," favorite_border "))],8,j)])]),Object(a["h"])("div",D,[Object(a["h"])("div",k,Object(a["G"])(e.DepartureStopNameZh)+"-"+Object(a["G"])(e.DestinationStopNameZh),1),Object(a["h"])("div",I,[e.City?(Object(a["w"])(),Object(a["g"])("span",w,Object(a["G"])(t.$filters.replaceCity(e.City)),1)):Object(a["f"])("",!0)])])],8,g)})),128))])])]),Object(a["h"])("div",{class:"gps-icon",onClick:e[4]||(e[4]=function(t){return R.locateGPS()})},C),N])])],64)}o("d81d"),o("4de4"),o("d3b7"),o("99af"),o("159b"),o("e9c4"),o("a434");var x=o("e11e"),U=o.n(x),$=o("cc8c"),A={},M=new U.a.Icon({iconUrl:o("e275"),iconSize:[49,49],iconAnchor:[24,24],popupAnchor:[0,-24]}),_={data:function(){return{isLoading:!1,locationMarkerID:"",optiondata:[],selectStationName:"",selectStationData:[],selectStationRouteID:[],selectRouteData:[],buslikes:[],buslikesId:[],city:"Taipei",cityList:$}},methods:{locateGPS:function(){var t=this;navigator.geolocation.getCurrentPosition((function(e){A.eachLayer((function(e){e._leaflet_id===t.locationMarkerID&&A.removeLayer(e)}));var o=[e.coords.latitude,e.coords.longitude];console.log(o),A.setView(o,15),document.querySelector(".gps-icon").classList.add("active");var a=U.a.marker([e.coords.latitude,e.coords.longitude],{icon:M});a.addTo(A),t.locationMarkerID=a._leaflet_id}))},getAllStationFromCity:function(){var t=this,e="https://ptx.transportdata.tw/MOTC/v2/Bus/Station/City/".concat(this.city,"?$select=StationName&$format=JSON");this.axios.get(e,{headers:this.$getAuthorizationHeader()}).then((function(e){t.optiondata=e.data.map((function(t){return t.StationName.Zh_tw})),t.optiondata=t.optiondata.filter((function(t,e,o){return o.indexOf(t)===e})),t.getStationData()})).catch((function(t){console.log(t)}))},getStationData:function(){var t=this,e="https://ptx.transportdata.tw/MOTC/v2/Bus/Station/City/".concat(this.city,"?$filter=StationName%2FZh_tw%20eq%20'").concat(this.selectStationName,"'&$format=JSON");this.axios.get(e,{headers:this.$getAuthorizationHeader()}).then((function(e){var o;t.selectStationData=e.data;var a=[];e.data.forEach((function(t){a.push(t.Stops.map((function(t){return t.RouteUID})))})),t.selectStationRouteID=(o=[]).concat.apply(o,a),t.selectStationRouteID=t.selectStationRouteID.filter((function(t,e,o){return o.indexOf(t)===e})),console.log(t.selectStationRouteID),t.getRouteData()})).catch((function(t){console.log(t)}))},getRouteData:function(){var t=this,e="https://ptx.transportdata.tw/MOTC/v2/Bus/Route/City/".concat(this.city,"?$format=JSON");this.axios.get(e,{headers:this.$getAuthorizationHeader()}).then((function(e){t.selectRouteData=e.data.filter((function(e){if(t.selectStationRouteID.includes(e.RouteUID))return e})),console.log(t.selectRouteData)})).catch((function(t){console.log(t)}))},toRouteDetail:function(t){if(console.log(t),"SPAN"!==event.target.tagName){var e={city:t.City,route:t.RouteName.Zh_tw,routeUID:t.RouteUID,direction:0,LatLon:[this.selectStationData[0].StationPosition.PositionLat,this.selectStationData[0].StationPosition.PositionLon]},o=encodeURIComponent(JSON.stringify(e));this.$router.push("/BusSearch/".concat(o))}},getLikes:function(){var t=localStorage.getItem("busLikes")?localStorage.getItem("busLikes"):"[]";this.buslikes=JSON.parse(t),this.buslikesId=this.buslikes.map((function(t){return t.routeUID})),console.log(this.buslikesId)},updateLikes:function(t){var e={data:{data:{},message:"收藏",success:!0}};this.buslikesId.includes(t.RouteUID)?(this.buslikes.splice(this.buslikes.map((function(t){return t.routeUID})).indexOf(t.RouteUID),1),this.buslikesId.splice(this.buslikesId.indexOf(t.RouteUID),1),this.$httpMessageState(e,"移除收藏")):(this.buslikes.push({routeUID:t.RouteUID,routeName:t.RouteName.Zh_tw,start:t.DepartureStopNameZh,end:t.DestinationStopNameZh,city:t.City}),this.buslikesId.push(t.RouteUID),this.$httpMessageState(e,"加入收藏"))},saveLocalStorage:function(t){var e=JSON.stringify(t);try{localStorage.setItem("busLikes",e)}catch(o){return!1}}},watch:{buslikes:{handler:function(t,e){this.saveLocalStorage(this.buslikes)},deep:!0}},mounted:function(){A=U.a.map("map",{zoomControl:!1,center:[25.0834397,121.4570441],zoom:13,tap:!1}),U.a.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(A),U.a.control.zoom({position:"bottomright"}).addTo(A),A.on("moveend",(function(){document.querySelector(".gps-icon").classList.remove("active")})),this.locateGPS(),this.getLikes(),this.getAllStationFromCity()}},z=o("6b0d"),J=o.n(z);const P=J()(_,[["render",L]]);e["default"]=P}}]);
//# sourceMappingURL=chunk-4d7d7bb3.ab31d54d.js.map